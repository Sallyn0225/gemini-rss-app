
version: '3'

services:
  gemini-rss:
    build: .
    image: gemini-rss-app
    container_name: gemini-rss
    # 关键配置：使用 host 网络模式
    # 这样容器内的 127.0.0.1 直接指向宿主机，从而能访问宿主机的 Clash (7890)
    # 同时省去了 NAT 转换，性能最高
    network_mode: "host"
    
    restart: always
    environment:
      - NODE_ENV=production
      # 管理接口密钥：请在实际部署时设置强密码
      # 可以通过 .env 文件或直接在此处配置
      # - ADMIN_SECRET=your-strong-admin-password
    volumes:
      # Mount a directory for persistent data, not a single file
      # This prevents Docker from creating a directory instead of a file
      - ./data:/app/data

    # 日志轮转，防止日志占满磁盘
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
